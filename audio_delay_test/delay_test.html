<html>
<head>
    <title>Latency Test for Sound Playback</title>
</head>
<body>
    <h1>Latency Test for Sound Playback</h1>
    <p>
    This tool is designed to see how much delay there can be between
    two identical audio files being played before a human listener
    thinks they sound 'yucky' or not 'in sync'.
    </p>

    <p>Enter delay between the two audio files (in ms) and click play.</p>

    <input id="latency" value="0">
    <input type="button" id="play" value="Loading..." disabled="disabled" />

    <script src="./soundmanager2.js"></script>

    <script>
    /**
     * I know, I know, inline scripts are bad. It's a prototype - shoot me.
     */

    var input_latency = document.getElementById("latency"),
        input_play = document.getElementById("play"),
        song1 = "rick1",
        song2 = "rick2",
        songfile = "./song.mp3";

    /**
     * This function is called whenever an Async loading method returns
     * to see if the page is finished loading yet. When it is, it updates
     * the UI
     */
    var ready = false,
        ready_counter = 0,
        num_async_events = 2;
    var check_ready = function() {
        if(++ready_counter >= num_async_events) {
            ready = true;
            input_play.disabled = "";
            input_play.value = "Click To Play";
        }
    }

    soundManager.setup({
        url: './swf/',
        onready: function() {
            // Load songs
            soundManager.createSound({
                id: song1,
                url: songfile,
                autoLoad: true,
                autoPlay: false,
                onload: check_ready,
                volume: 50
            });

            soundManager.createSound({
                id: song2,
                url: songfile,
                autoLoad: true,
                autoPlay: false,
                onload: check_ready,
                volume: 50
            });
        }
    });
    
    var playing = false;
    input_play.onclick = function() {
        if(ready) {
            if(playing) {
                soundManager.stopAll();
                playing = false;
                input_play.value = "Click To Play";
            } else {
                var delay = input_latency.value;
                
                soundManager.play(song1);
                setTimeout(function() {
                    soundManager.play(song2);
                    playing = true;
                    input_play.value = "Stop";
                }, delay);
            }
        }
    }
    
    </script>
</body>
</html>
